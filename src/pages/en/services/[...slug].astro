---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { loadImagesManifest } from '../../../utils/imagesManifest';
import { buildImageAlt } from '../../../utils/imageSeo';
import { PHONE_NUMBER, PHONE_TEL } from '../../../consts';
import { buildWhatsAppLink, buildWhatsAppMessage } from '../../../utils/whatsapp';
import Gallery from '../../../components/common/Gallery.astro';
import { getServiceLabel } from '../../../config/serviceLabels';

export async function getStaticPaths() {
  const services = await getCollection('services_en');

  // Load manifest for images
  const manifest = loadImagesManifest();

  return services.map(entry => {
    // Filter images for this category
    const categoryImages = manifest.filter((m: any) => m.category === entry.slug);
    
    return {
      params: { slug: entry.slug },
      props: { entry, images: categoryImages },
    };
  });
}

const { entry, images } = Astro.props;
const { Content } = await entry.render();
const displayTitle = getServiceLabel(entry.slug, 'en') ?? entry.data.title;
const relatedPosts = (await getCollection('blog_en'))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

const metaTitle = `${displayTitle} | Corporate Signage in Istanbul - A2 Advertising`;
const metaDescription = `${entry.data.description} Get a fast quote for discovery, production, and installation across Istanbul.`;
const breadcrumbs = [
  { name: 'Home', item: '/en/' },
  { name: 'Services', item: '/en/services/' },
  { name: displayTitle, item: `/en/services/${entry.slug}/` },
];

const microAnswerLines = [
  `${entry.data.title} is a corporate signage solution designed to elevate brand visibility.`,
  'Ideal for retail chains, offices, production sites, and multi-site businesses.',
  'Discovery, design, production, and installation are handled by one team.',
  'Lead time is planned after measurements and materials are confirmed.',
  'We support on-site discovery and installation across Istanbul.',
  'Request a quote via the form or call us directly.',
];
const quickFacts = [
  { label: 'Scope', value: 'Discovery, design, production, installation.' },
  { label: 'Use Cases', value: 'Indoor and outdoor projects.' },
  { label: 'Lead Time', value: 'Planned after measurements and materials are confirmed.' },
];
const useCases = [
  'Retail chains and branded branches',
  'Hotels, hospitals, and healthcare facilities',
  'Factories, production sites, and warehouses',
  'Plazas, offices, and showrooms',
  'Education and public buildings',
];
const materials = [
  'Stainless steel, aluminum, and composite panels',
  'Acrylic and plexi surfaces',
  'LED lighting and electrical infrastructure',
  'Vinyl, foil, and UV print applications',
  'Glass, wood, and custom finishes',
];
const processSteps = [
  'Discovery and needs analysis',
  'Design and technical approval',
  'Production and quality control',
  'Installation and delivery',
];
const pricingFactors = [
  'Dimensions and installation height',
  'Material selection (aluminum, stainless, acrylic, etc.)',
  'Lighting type and electrical requirements',
  'Quantity and installation location',
  'Custom production and expedited delivery needs',
];
const warrantyNote = 'We provide project-specific warranty and maintenance plans based on materials, usage conditions, and installation details.';
const faq = [
  {
    question: `How long does ${entry.data.title} production take?`,
    answer: 'Once discovery and technical details are confirmed, we create a production plan; expedited timelines are available when needed.',
  },
  {
    question: 'Do you handle installation?',
    answer: 'Yes. Our in-house team provides safe installation across Istanbul.',
  },
  {
    question: 'How does design approval work for corporate projects?',
    answer: 'We prepare options aligned with brand guidelines and present technical drawings and placement details for approval.',
  },
  {
    question: 'Do you offer warranty and maintenance?',
    answer: 'We provide project-specific warranty and maintenance options based on materials and workmanship.',
  },
  {
    question: 'Which details are needed during discovery?',
    answer: 'Location, measurements, intended use, lighting needs, and brand requirements are confirmed during discovery.',
  },
];
const topDistricts = [
  { label: 'Kağıthane', href: '/en/service-areas/kagithane-tabela/' },
  { label: 'Şişli', href: '/en/service-areas/sisli-tabela/' },
  { label: 'Beşiktaş', href: '/en/service-areas/besiktas-tabela/' },
  { label: 'Kadıköy', href: '/en/service-areas/kadikoy-tabela/' },
  { label: 'Başakşehir', href: '/en/service-areas/basaksehir-tabela/' },
  { label: 'Ümraniye', href: '/en/service-areas/umraniye-tabela/' },
];
const whatsappMessage = buildWhatsAppMessage({ lang: 'en', pageTitle: displayTitle });
const whatsappLink = buildWhatsAppLink(whatsappMessage);
---

<Layout
  title={metaTitle}
  description={metaDescription}
  lang="en"
  breadcrumbs={breadcrumbs}
  faq={faq}
  whatsappTitle={entry.data.title}
>
  <!-- Hero Section -->
  <div class="relative h-[50vh] flex items-center justify-center text-white">
    <div class="absolute inset-0 z-0">
      <img src={entry.data.heroImage} alt={entry.data.title} class="w-full h-full object-cover" />
      <div class="absolute inset-0 bg-secondary/80 mix-blend-multiply"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-secondary via-transparent to-transparent"></div>
    </div>
    <div class="relative z-10 container mx-auto px-4 mt-20">
      <h1 class="font-heading font-black text-4xl md:text-6xl mb-4 drop-shadow-lg">{displayTitle}</h1>
      <ul class="flex gap-2 text-sm text-gray-300 font-medium tracking-wide">
        <li><a href="/en/" class="hover:text-primary transition-colors">Home</a></li>
        <li>/</li>
        <li><a href="/en/services/" class="hover:text-primary transition-colors">Services</a></li>
        <li>/</li>
        <li class="text-primary">{displayTitle}</li>
      </ul>
    </div>
  </div>

  <div class="container mx-auto px-4 py-20 grid grid-cols-1 lg:grid-cols-3 gap-12">
    <!-- Main Content -->
    <div class="lg:col-span-2 prose prose-lg prose-invert max-w-none prose-headings:font-heading prose-headings:font-bold prose-a:text-primary prose-strong:text-white">
      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h2 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Quick Answer
        </h2>
        <ul class="space-y-3 text-gray-300 text-sm">
          {microAnswerLines.map((line, index) => (
            <li class="flex items-start gap-3">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>
                {line}
                {index === microAnswerLines.length - 1 && (
                  <>
                    {' '}
                    <a href="/en/contact/" class="text-primary hover:text-primary-hover">Contact</a>
                  </>
                )}
              </span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Gallery Grid - Positioned high for visual impact -->
      {images.length > 0 && (
        <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
          <h2 class="font-heading font-bold text-2xl mb-6 text-white flex items-center gap-2">
            <span class="w-1 h-8 bg-primary block rounded-full"></span>
            Project Gallery
          </h2>
          <Gallery
            images={images.map((img: any) => ({
              paths: img.paths,
              category: img.category,
              alt: buildImageAlt({ category: entry.slug, lang: 'en' }),
            }))}
            lang="en"
            category={entry.slug}
            initialLimit={6}
            aspectRatio="square"
          />
        </div>
      )}

      <Content />
      
      {entry.data.features && (
        <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
          <h3 class="font-heading font-bold text-2xl mb-6 text-white flex items-center gap-2">
            <span class="w-1 h-8 bg-primary block rounded-full"></span>
            Features
          </h3>
          <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {entry.data.features.map((f: string) => (
              <li class="flex items-center gap-3 text-gray-300">
                <div class="w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center text-primary shrink-0">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                </div>
                {f}
              </li>
            ))}
          </ul>
        </div>
      )}

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Quick Facts
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {quickFacts.map((fact) => (
            <div class="bg-secondary/60 rounded-lg p-4 border border-white/5">
              <div class="text-xs text-gray-400 uppercase tracking-widest">{fact.label}</div>
              <div class="text-white font-semibold mt-2">{fact.value}</div>
            </div>
          ))}
        </div>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Corporate Use Cases
        </h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {useCases.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Materials & Options
        </h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {materials.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Process
        </h3>
        <ol class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm list-decimal list-inside">
          {processSteps.map((item) => (
            <li>{item}</li>
          ))}
        </ol>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Warranty & Maintenance
        </h3>
        <p class="text-gray-300 text-sm">{warrantyNote}</p>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Pricing Factors
        </h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {pricingFactors.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-6 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          FAQ
        </h3>
        <div class="space-y-5">
          {faq.map((item) => (
            <div class="border border-white/5 rounded-lg p-4 bg-secondary/60">
              <h4 class="text-white font-semibold">{item.question}</h4>
              <p class="text-gray-400 text-sm mt-2">{item.answer}</p>
            </div>
          ))}
        </div>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Top Service Areas in Istanbul
        </h3>
        <div class="flex flex-wrap gap-3">
          {topDistricts.map((district) => (
            <a href={district.href} class="px-4 py-2 rounded-full border border-white/10 text-sm text-gray-300 hover:border-primary/60 hover:text-white transition-colors">
              {district.label}
            </a>
          ))}
        </div>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Related Blog Posts
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {relatedPosts.map((post) => (
            <a href={`/en/blog/${post.slug}/`} class="block bg-secondary/60 border border-white/5 rounded-lg p-4 text-gray-300 hover:text-white hover:border-primary/50 transition-colors">
              <div class="text-sm font-semibold">{post.data.title}</div>
              <div class="text-xs text-gray-500 mt-2">{post.data.description}</div>
            </a>
          ))}
        </div>
      </div>

      <div class="my-10 bg-accent-light p-8 rounded-xl border border-white/5 shadow-inner not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white flex items-center gap-2">
          <span class="w-1 h-8 bg-primary block rounded-full"></span>
          Quick Quote & Discovery
        </h3>
        <p class="text-gray-300 text-sm mb-6">
          Contact our team for a fast quote or to plan an on-site discovery across Istanbul.
        </p>
        <div class="flex flex-wrap gap-3">
          <a href="/en/get-quote/" data-track="quote" data-lang="en" class="bg-primary text-secondary font-bold py-3 px-6 rounded-lg hover:bg-white transition-all">
            Get a Quote
          </a>
          <a href={`tel:${PHONE_TEL}`} data-track="call" data-lang="en" class="border border-white/20 text-white font-bold py-3 px-6 rounded-lg hover:border-white transition-all">
            Call: {PHONE_NUMBER}
          </a>
          <a href={whatsappLink} data-track="whatsapp" data-lang="en" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-500 transition-all">
            WhatsApp
          </a>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="space-y-8">
      <div class="bg-accent-light p-8 rounded-xl border border-white/5 sticky top-24 shadow-2xl">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white uppercase tracking-tight">Get a Quote <span class="text-primary">Now</span></h3>
        <p class="text-gray-400 mb-6 text-sm leading-relaxed">
          Contact us for professional support and a quote for your {entry.data.title} needs. We respond quickly.
        </p>
        <div class="space-y-4">
          <a href="/en/get-quote/" data-track="quote" data-lang="en" class="block w-full text-center bg-primary text-secondary font-black py-4 rounded-lg hover:bg-white transition-all transform hover:-translate-y-1 shadow-lg shadow-primary/20 uppercase tracking-widest text-sm">
            Request a Quote
          </a>
          <a href={whatsappLink} data-track="whatsapp" data-lang="en" class="flex items-center justify-center gap-2 w-full text-center bg-green-600 text-white font-bold py-4 rounded-lg hover:bg-green-500 transition-all border border-green-500/50">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.588-5.946 0-6.556 5.332-11.891 11.893-11.891 3.181 0 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.481 8.414 0 6.556-5.332 11.892-11.893 11.892-1.99 0-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.591 5.405 0 9.801-4.398 9.801-9.805 0-5.403-4.395-9.804-9.801-9.804-5.408 0-9.805 4.398-9.805 9.804 0 2.229.615 4.317 1.784 6.149l-1.109 4.041 4.139-1.08zm9.977-6.862c-.32-.16-1.89-.932-2.185-1.041-.297-.108-.512-.16-.726.16-.215.32-.834 1.042-1.023 1.256-.188.214-.377.241-.697.08-.32-.16-1.35-.497-2.57-1.587-.948-.847-1.893-1.777-2.214-.188-.321-.02-.494.14-.654.144-.143.32-.375.48-.563.16-.188.214-.321.32-.536.108-.214.054-.401-.027-.562-.08-.16-.726-1.751-.995-2.394-.26-.629-.53-.543-.726-.553-.188-.01-.403-.012-.617-.012s-.564.08-.859.401c-.296.321-1.128 1.102-1.128 2.688 0 1.587 1.155 3.118 1.316 3.332.16.214 2.274 3.472 5.508 4.871.77.333 1.37.532 1.839.681.773.245 1.477.211 2.032.128.618-.093 1.891-.773 2.158-1.517.268-.745.268-1.383.189-1.516-.08-.135-.297-.215-.617-.375z"/></svg>
            Text on WhatsApp
          </a>
        </div>
      </div>
    </aside>
  </div>

</Layout>
