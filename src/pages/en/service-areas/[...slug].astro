---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { buildWhatsAppLink, buildWhatsAppMessage } from '../../../utils/whatsapp';

export async function getStaticPaths() {
  const districts = await getCollection('districts_en');
  const sorted = [...districts].sort((a, b) =>
    a.data.districtName.localeCompare(b.data.districtName, 'en'),
  );

  return sorted.map((entry, index) => {
    const neighbors = [];
    let offset = 1;
    while (neighbors.length < 4 && offset < sorted.length) {
      const neighbor = sorted[(index + offset) % sorted.length];
      if (neighbor.slug !== entry.slug) {
        neighbors.push({
          name: neighbor.data.districtName,
          slug: neighbor.slug,
        });
      }
      offset += 1;
    }

    return {
      params: { slug: entry.slug },
      props: { entry, neighbors },
    };
  });
}

const { entry, neighbors } = Astro.props;
const { Content } = await entry.render();
const relatedPosts = (await getCollection('blog_en'))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

const title = `${entry.data.title} | A2 Advertising`;
const breadcrumbs = [
  { name: 'Home', item: '/en/' },
  { name: 'Service Areas', item: '/en/service-areas/' },
  { name: entry.data.districtName, item: `/en/service-areas/${entry.slug}/` },
];

const focusProfiles = [
  'We deliver durable signage for industrial zones, factories, workshops, and logistics hubs in the area.',
  'We plan wayfinding, facade, and interior signage for hotels, hospitals, clinics, and education campuses.',
  'We craft brand-consistent signage and storefront applications for malls, chain stores, and retail brands.',
  'We support corporate offices and showrooms with modern facade and interior sign systems.',
];
const introTemplates = [
  (name: string) => `We manage discovery, design, production, and installation for ${name} with a single team.`,
  (name: string) => `We plan signage and advertising solutions for ${name} and deliver fast on-site execution.`,
  (name: string) => `We provide turnkey signage systems that boost visibility for businesses in ${name}.`,
  (name: string) => `We deliver sector-specific signage design and installation services across ${name}.`,
];

const slugScore = entry.slug.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
const introParagraph = introTemplates[slugScore % introTemplates.length](entry.data.districtName);
const b2bFocusParagraph = focusProfiles[slugScore % focusProfiles.length];

const quickAnswer = `We handle signage, facade, and wayfinding needs in ${entry.data.districtName} from discovery to installation.`;
const quickFacts = [
  { label: 'Scope', value: 'Discovery, design, production, installation.' },
  { label: 'Coverage', value: `${entry.data.districtName} and nearby neighborhoods.` },
  { label: 'Lead Time', value: 'Planned after measurements and materials are confirmed.' },
];
const pricingFactors = [
  'Application area and installation height',
  'Material type and production method',
  'Lighting type and electrical requirements',
  'Quantity, location, and access conditions',
  'Urgency and project scope',
];
const corporateSolutions = [
  'Facade signage and exterior branding',
  'Illuminated channel letters and stainless letters',
  'Totem signs and wayfinding systems',
  'Reception desk and interior branding',
  'Vehicle wraps and storefront solutions',
];
const faq = [
  {
    question: `Is discovery free in ${entry.data.districtName}?`,
    answer: 'Yes. We offer free discovery across Istanbul and prepare a detailed proposal after measurements.',
  },
  {
    question: 'How does installation work?',
    answer: 'After production, our field team schedules and completes the on-site installation.',
  },
  {
    question: 'How do you plan corporate signage projects?',
    answer: 'We define the scope after discovery and manage design, production, and installation as a single plan.',
  },
  {
    question: 'Can you handle urgent projects?',
    answer: 'Depending on scope and materials, we can create an accelerated production plan.',
  },
  {
    question: 'Do you provide warranty and maintenance?',
    answer: 'We offer project-specific warranty and maintenance options based on materials and use conditions.',
  },
];

const topServices = [
  { label: 'Illuminated Signs', href: '/en/services/isikli-isiksiz-tabelalar/' },
  { label: 'Stainless Letters', href: '/en/services/paslanmaz-harfler/' },
  { label: 'Totem Signage', href: '/en/services/totem/' },
  { label: 'Facade Signage', href: '/en/services/cephe-tabela/' },
  { label: 'Vehicle Wrapping', href: '/en/services/arac-giydirme/' },
  { label: 'Wayfinding', href: '/en/services/yonlendirme/' },
];
const whatsappMessage = buildWhatsAppMessage({
  lang: 'en',
  pageTitle: entry.data.title,
  location: entry.data.districtName,
});
const whatsappLink = buildWhatsAppLink(whatsappMessage);
---

<Layout
  title={title}
  description={entry.data.description}
  lang="en"
  breadcrumbs={breadcrumbs}
  faq={faq}
  whatsappTitle={entry.data.title}
  whatsappLocation={entry.data.districtName}
>
  <!-- Hero Section -->
  <div class="relative h-[40vh] flex items-center justify-center text-white overflow-hidden bg-secondary">
    <div class="absolute inset-0 z-0">
      <img src={entry.data.heroImage} alt={entry.data.title} class="w-full h-full object-cover opacity-30" />
      <div class="absolute inset-0 bg-gradient-to-t from-secondary via-transparent to-transparent"></div>
    </div>
    <div class="relative z-10 container mx-auto px-4 mt-20 text-center">
      <h1 class="font-heading font-black text-4xl md:text-5xl mb-4 drop-shadow-lg text-white uppercase tracking-tight">
        <span class="text-primary">{entry.data.districtName}</span> SIGNAGE
      </h1>
      <ul class="flex justify-center gap-2 text-sm text-gray-400 font-medium tracking-wide">
        <li><a href="/en/" class="hover:text-primary transition-colors">Home</a></li>
        <li>/</li>
        <li><a href="/en/service-areas/" class="hover:text-primary transition-colors">Service Areas</a></li>
        <li>/</li>
        <li class="text-primary">{entry.data.districtName}</li>
      </ul>
    </div>
  </div>

  <div class="container mx-auto px-4 py-20 grid grid-cols-1 lg:grid-cols-3 gap-12">
    <!-- Main Content -->
    <div class="lg:col-span-2 prose prose-lg prose-invert max-w-none prose-headings:font-heading prose-headings:font-bold prose-headings:tracking-tight prose-a:text-primary prose-strong:text-white prose-p:text-gray-300 prose-p:leading-relaxed prose-li:text-gray-300 prose-h2:text-white prose-h2:mt-10 prose-h2:mb-4 prose-h3:text-white prose-h3:mt-8 prose-h3:mb-3">
      <div class="not-prose bg-accent-light border border-white/5 rounded-2xl p-8 mb-10">
        <p class="text-gray-200 text-lg leading-relaxed">{introParagraph}</p>
        <p class="text-gray-300 mt-4 leading-relaxed">{b2bFocusParagraph}</p>
      </div>

      <Content />

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Quick Answer</h3>
        <p class="text-gray-300">{quickAnswer}</p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
          {quickFacts.map((fact) => (
            <div class="bg-secondary/60 rounded-lg p-4 border border-white/5">
              <div class="text-xs text-gray-400 uppercase tracking-widest">{fact.label}</div>
              <div class="text-white font-semibold mt-2">{fact.value}</div>
            </div>
          ))}
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Corporate Solutions</h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {corporateSolutions.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Pricing Factors</h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {pricingFactors.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-6 text-white">FAQ</h3>
        <div class="space-y-5">
          {faq.map((item) => (
            <div class="border border-white/5 rounded-lg p-4 bg-secondary/60">
              <h4 class="text-white font-semibold">{item.question}</h4>
              <p class="text-gray-300 text-sm mt-2">{item.answer}</p>
            </div>
          ))}
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Top Services in {entry.data.districtName}</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          {topServices.map((service) => (
            <a href={service.href} class="flex items-center justify-between bg-secondary/60 border border-white/5 rounded-lg px-4 py-3 text-gray-300 hover:text-primary transition-colors">
              <span>{service.label}</span>
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </a>
          ))}
        </div>
        <a href="/en/get-quote/" data-track="quote" data-lang="en" class="inline-flex items-center gap-2 mt-6 bg-primary text-secondary font-bold px-6 py-3 rounded-lg hover:bg-white transition-all">
          Get a Quote
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
        </a>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Related Blog Posts</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {relatedPosts.map((post) => (
            <a href={`/en/blog/${post.slug}/`} class="block bg-secondary/60 border border-white/5 rounded-lg p-4 text-gray-300 hover:text-white hover:border-primary/50 transition-colors">
              <div class="text-sm font-semibold">{post.data.title}</div>
              <div class="text-xs text-gray-500 mt-2">{post.data.description}</div>
            </a>
          ))}
        </div>
      </div>
      
      <div class="mt-12 p-8 rounded-2xl bg-accent-light border border-white/5 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-primary/20 transition-colors"></div>
        <h3 class="font-heading font-bold text-2xl mb-4 text-white relative z-10 text-balance">Get a Free Discovery in {entry.data.districtName}</h3>
        <p class="text-gray-300 mb-6 relative z-10">
          Our expert team provides free discovery services in and around {entry.data.districtName}. Let's determine the signage model that best represents your brand by on-site inspection. Sharing your location via Google Maps helps us plan faster.
        </p>
        <div class="flex flex-wrap gap-4 relative z-10">
          <a href="/en/get-quote/" data-track="quote" data-lang="en" class="bg-primary text-secondary font-bold py-3 px-8 rounded hover:bg-white transition-all transform hover:-translate-y-1">
            Get a Quote
          </a>
          <a href={whatsappLink} data-track="whatsapp" data-lang="en" class="bg-green-600 text-white font-bold py-3 px-8 rounded hover:bg-green-500 transition-all flex items-center gap-2">
             WhatsApp
          </a>
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Nearby Districts</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          {neighbors.map((neighbor) => (
            <a href={`/en/service-areas/${neighbor.slug}/`} class="text-gray-300 hover:text-primary transition-colors text-sm">
              {neighbor.name}
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="space-y-8">
      <div class="bg-accent-light p-8 rounded-2xl border border-white/5 sticky top-24">
        <h3 class="font-heading font-bold text-xl mb-6 text-white border-b border-primary/30 pb-2">Popular Services</h3>
        <ul class="space-y-4">
          {[
            { label: 'Illuminated Signs', href: '/en/services/isikli-isiksiz-tabelalar/' },
            { label: 'Channel Letters', href: '/en/services/paslanmaz-harfler/' },
            { label: 'Stainless Steel Letters', href: '/en/services/paslanmaz-harfler/' },
            { label: 'Totem Signage', href: '/en/services/totem/' },
            { label: 'Facade Cladding', href: '/en/services/cephe-tabela/' },
            { label: 'Vehicle Wrapping', href: '/en/services/arac-giydirme/' }
          ].map(item => (
            <li>
              <a href={item.href} class="flex items-center justify-between text-gray-300 hover:text-primary group transition-all">
                <span>{item.label}</span>
                <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <div class="bg-primary/5 p-8 rounded-2xl border border-primary/20">
        <h3 class="font-heading font-bold text-xl mb-4 text-primary">All Istanbul Coverage</h3>
        <p class="text-sm text-gray-300 leading-relaxed">
          We provide professional production and assembly services in all 39 districts of Istanbul, not only in {entry.data.districtName}. We are here with more than 10 years of experience.
        </p>
      </div>
    </aside>
  </div>
</Layout>
