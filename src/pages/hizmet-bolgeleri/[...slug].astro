---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { buildWhatsAppLink, buildWhatsAppMessage } from '../../utils/whatsapp';

export async function getStaticPaths() {
  const districts = await getCollection('districts');
  const sorted = [...districts].sort((a, b) =>
    a.data.districtName.localeCompare(b.data.districtName, 'tr'),
  );

  return sorted.map((entry, index) => {
    const neighbors = [];
    let offset = 1;
    while (neighbors.length < 4 && offset < sorted.length) {
      const neighbor = sorted[(index + offset) % sorted.length];
      if (neighbor.slug !== entry.slug) {
        neighbors.push({
          name: neighbor.data.districtName,
          slug: neighbor.slug,
        });
      }
      offset += 1;
    }

    return {
      params: { slug: entry.slug },
      props: { entry, neighbors },
    };
  });
}

const { entry, neighbors } = Astro.props;
const { Content } = await entry.render();
const relatedPosts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

const title = `${entry.data.title} | A2 Reklam`;
const breadcrumbs = [
  { name: 'Anasayfa', item: '/' },
  { name: 'Hizmet Bölgeleri', item: '/hizmet-bolgeleri/' },
  { name: entry.data.districtName, item: `/hizmet-bolgeleri/${entry.slug}/` },
];

const focusProfiles = [
  'OSB ve üretim tesisleri, atölyeler, lojistik depolar ve teknik servis noktaları için dayanıklı tabela çözümleri sunuyoruz.',
  'Otel, hastane, klinik ve eğitim kurumları için yönlendirme, cephe ve iç mekan tabela sistemleri planlıyoruz.',
  'AVM, zincir mağazalar ve perakende markaları için kurumsal kimliğe uygun tabela ve vitrin uygulamaları üretiyoruz.',
  'Plaza, ofis ve showroom projelerinde marka görünürlüğünü artıran modern tabela ve iç mekan uygulamaları sağlıyoruz.',
];
const introTemplates = [
  (name: string) => `${name} bölgesinde keşif, tasarım, üretim ve montaj süreçlerini tek ekip halinde yönetiyoruz.`,
  (name: string) => `${name} için tabela ve reklam çözümlerini proje bazlı planlayıp hızlı uygulama sağlıyoruz.`,
  (name: string) => `${name} ilçesinde işletmenizin görünürlüğünü artıracak tabela sistemlerini anahtar teslim sunuyoruz.`,
  (name: string) => `${name} bölgesinde farklı sektörlere uygun tabela tasarımı ve montaj hizmeti veriyoruz.`,
];

const slugScore = entry.slug.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
const introParagraph = introTemplates[slugScore % introTemplates.length](entry.data.districtName);
const b2bFocusParagraph = focusProfiles[slugScore % focusProfiles.length];

const quickAnswer = `${entry.data.districtName} bölgesinde tabela, cephe ve yönlendirme ihtiyaçlarını keşiften montaja kadar tek noktadan karşılıyoruz.`;
const quickFacts = [
  { label: 'Hizmet Kapsamı', value: 'Keşif, tasarım, üretim ve montaj.' },
  { label: 'Servis Alanı', value: `${entry.data.districtName} ve çevre mahalleler.` },
  { label: 'Teslim Süresi', value: 'Ölçü ve malzeme netleşince planlanır.' },
];
const pricingFactors = [
  'Uygulama alanı ve montaj yüksekliği',
  'Malzeme türü ve üretim tekniği',
  'Aydınlatma tipi ve güç altyapısı',
  'Adet, lokasyon ve montaj erişimi',
  'İşin aciliyeti ve proje kapsamı',
];
const corporateSolutions = [
  'Cephe tabela ve dış cephe giydirme',
  'Işıklı kutu harf ve paslanmaz harf',
  'Totem ve yönlendirme sistemleri',
  'Kurumsal giriş, banko ve iç mekan uygulamaları',
  'Araç giydirme ve vitrin çözümleri',
];
const faq = [
  {
    question: `${entry.data.districtName} bölgesinde keşif ücretsiz mi?`,
    answer: 'İstanbul genelinde ücretsiz keşif sunuyor, ölçü ve ihtiyaçlara göre net teklif hazırlıyoruz.',
  },
  {
    question: 'Montaj süreci nasıl ilerliyor?',
    answer: 'Üretim tamamlandıktan sonra saha ekibimizle planlı montaj gerçekleştiriyoruz.',
  },
  {
    question: 'Kurumsal projelerde süreç nasıl planlanıyor?',
    answer: 'Keşif sonrası tasarım, üretim ve montaj adımlarını proje planına göre yönetiyoruz.',
  },
  {
    question: 'Acil işlerde hizmet veriyor musunuz?',
    answer: 'Proje kapsamına göre hızlandırılmış üretim ve montaj planı oluşturabiliyoruz.',
  },
  {
    question: 'Garanti ve bakım desteği sağlıyor musunuz?',
    answer: 'Malzeme ve işçilik için proje bazlı garanti ve bakım seçenekleri sunuyoruz.',
  },
];

const topServices = [
  { label: 'Işıklı Tabela', href: '/hizmetler/isikli-isiksiz-tabelalar/' },
  { label: 'Paslanmaz Harf', href: '/hizmetler/paslanmaz-harfler/' },
  { label: 'Totem Tabela', href: '/hizmetler/totem/' },
  { label: 'Cephe Tabela', href: '/hizmetler/cephe-tabela/' },
  { label: 'Araç Giydirme', href: '/hizmetler/arac-giydirme/' },
  { label: 'Yönlendirme', href: '/hizmetler/yonlendirme/' },
];
const whatsappMessage = buildWhatsAppMessage({
  lang: 'tr',
  pageTitle: entry.data.title,
  location: entry.data.districtName,
});
const whatsappLink = buildWhatsAppLink(whatsappMessage);
---

<Layout
  title={title}
  description={entry.data.description}
  lang="tr"
  breadcrumbs={breadcrumbs}
  faq={faq}
  whatsappTitle={entry.data.title}
  whatsappLocation={entry.data.districtName}
>
  <!-- Hero Section -->
  <div class="relative h-[40vh] flex items-center justify-center text-white overflow-hidden bg-secondary">
    <div class="absolute inset-0 z-0">
      <img src={entry.data.heroImage} alt={entry.data.title} class="w-full h-full object-cover opacity-30" />
      <div class="absolute inset-0 bg-gradient-to-t from-secondary via-transparent to-transparent"></div>
    </div>
    <div class="relative z-10 container mx-auto px-4 mt-20 text-center">
      <h1 class="font-heading font-black text-4xl md:text-5xl mb-4 drop-shadow-lg text-white uppercase tracking-tight">
        <span class="text-primary">{entry.data.districtName}</span> TABELA
      </h1>
      <ul class="flex justify-center gap-2 text-sm text-gray-400 font-medium tracking-wide">
        <li><a href="/" class="hover:text-primary transition-colors">Anasayfa</a></li>
        <li>/</li>
        <li><a href="/hizmet-bolgeleri/" class="hover:text-primary transition-colors">Hizmet Bölgeleri</a></li>
        <li>/</li>
        <li class="text-primary">{entry.data.districtName}</li>
      </ul>
    </div>
  </div>

  <div class="container mx-auto px-4 py-20 grid grid-cols-1 lg:grid-cols-3 gap-12">
    <!-- Main Content -->
    <div class="lg:col-span-2 prose prose-lg prose-invert max-w-none prose-headings:font-heading prose-headings:font-bold prose-a:text-primary prose-strong:text-white prose-p:text-gray-400">
      <div class="not-prose bg-accent-light border border-white/5 rounded-2xl p-8 mb-10">
        <p class="text-gray-200 text-lg leading-relaxed">{introParagraph}</p>
        <p class="text-gray-400 mt-4 leading-relaxed">{b2bFocusParagraph}</p>
      </div>

      <Content />

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Hızlı Cevap</h3>
        <p class="text-gray-300">{quickAnswer}</p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
          {quickFacts.map((fact) => (
            <div class="bg-secondary/60 rounded-lg p-4 border border-white/5">
              <div class="text-xs text-gray-400 uppercase tracking-widest">{fact.label}</div>
              <div class="text-white font-semibold mt-2">{fact.value}</div>
            </div>
          ))}
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Kurumsal Çözümler</h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {corporateSolutions.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Fiyatı Etkileyen Unsurlar</h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 text-gray-300 text-sm">
          {pricingFactors.map((item) => (
            <li class="flex items-start gap-2">
              <span class="w-2 h-2 bg-primary rounded-full mt-2"></span>
              <span>{item}</span>
            </li>
          ))}
        </ul>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-6 text-white">Sık Sorulan Sorular</h3>
        <div class="space-y-5">
          {faq.map((item) => (
            <div class="border border-white/5 rounded-lg p-4 bg-secondary/60">
              <h4 class="text-white font-semibold">{item.question}</h4>
              <p class="text-gray-400 text-sm mt-2">{item.answer}</p>
            </div>
          ))}
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">{entry.data.districtName} Bölgesinde Öne Çıkan Hizmetler</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          {topServices.map((service) => (
            <a href={service.href} class="flex items-center justify-between bg-secondary/60 border border-white/5 rounded-lg px-4 py-3 text-gray-300 hover:text-primary transition-colors">
              <span>{service.label}</span>
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </a>
          ))}
        </div>
        <a href="/teklif-al/" data-track="lead-click" data-lead-type="quote" data-lang="tr" class="inline-flex items-center gap-2 mt-6 bg-primary text-secondary font-bold px-6 py-3 rounded-lg hover:bg-white transition-all">
          Teklif Al
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
        </a>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">İlgili Blog Yazıları</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {relatedPosts.map((post) => (
            <a href={`/blog/${post.slug}/`} class="block bg-secondary/60 border border-white/5 rounded-lg p-4 text-gray-300 hover:text-white hover:border-primary/50 transition-colors">
              <div class="text-sm font-semibold">{post.data.title}</div>
              <div class="text-xs text-gray-500 mt-2">{post.data.description}</div>
            </a>
          ))}
        </div>
      </div>

      <div class="mt-12 p-8 rounded-2xl bg-accent-light border border-white/5 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-16 -mt-16 group-hover:bg-primary/20 transition-colors"></div>
        <h3 class="font-heading font-bold text-2xl mb-4 text-white relative z-10">{entry.data.districtName} Bölgesi İçin Hemen Keşif İsteyin</h3>
        <p class="text-gray-400 mb-6 relative z-10">
          Uzman ekibimiz {entry.data.districtName} ve çevresinde ücretsiz keşif hizmeti sunmaktadır. Markanızı en iyi yansıtacak tabela modelini yerinde inceleyerek belirleyelim. Konumunuzu Google Maps üzerinden paylaşmanız planlamayı hızlandırır.
        </p>
        <div class="flex flex-wrap gap-4 relative z-10">
          <a href="/teklif-al/" data-track="lead-click" data-lead-type="quote" data-lang="tr" class="bg-primary text-secondary font-bold py-3 px-8 rounded hover:bg-white transition-all transform hover:-translate-y-1">
            Teklif Al
          </a>
          <a href={whatsappLink} data-track="lead-click" data-lead-type="whatsapp" data-lang="tr" class="bg-green-600 text-white font-bold py-3 px-8 rounded hover:bg-green-500 transition-all flex items-center gap-2">
             WhatsApp
          </a>
        </div>
      </div>

      <div class="mt-12 bg-accent-light p-8 rounded-2xl border border-white/5 not-prose">
        <h3 class="font-heading font-bold text-2xl mb-4 text-white">Yakındaki İlçeler</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          {neighbors.map((neighbor) => (
            <a href={`/hizmet-bolgeleri/${neighbor.slug}/`} class="text-gray-300 hover:text-primary transition-colors text-sm">
              {neighbor.name}
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="space-y-8">
      <div class="bg-accent-light p-8 rounded-2xl border border-white/5 sticky top-24">
        <h3 class="font-heading font-bold text-xl mb-6 text-white border-b border-primary/30 pb-2">Popüler Hizmetler</h3>
        <ul class="space-y-4">
          {[
            { label: 'Işıklı Tabela', href: '/hizmetler/isikli-isiksiz-tabelalar/' },
            { label: 'Kutu Harf', href: '/hizmetler/paslanmaz-harfler/' },
            { label: 'Paslanmaz Harf', href: '/hizmetler/paslanmaz-harfler/' },
            { label: 'Totem Tabela', href: '/hizmetler/totem/' },
            { label: 'Cephe Giydirme', href: '/hizmetler/cephe-tabela/' },
            { label: 'Araç Giydirme', href: '/hizmetler/arac-giydirme/' }
          ].map(item => (
            <li>
              <a href={item.href} class="flex items-center justify-between text-gray-400 hover:text-primary group transition-all">
                <span>{item.label}</span>
                <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
              </a>
            </li>
          ))}
        </ul>
      </div>

      <div class="bg-primary/5 p-8 rounded-2xl border border-primary/20">
        <h3 class="font-heading font-bold text-xl mb-4 text-primary">İstanbul Geneli Hizmet</h3>
        <p class="text-sm text-gray-400 leading-relaxed">
          Sadece {entry.data.districtName} değil, İstanbul'un 39 ilçesinde profesyonel üretim ve montaj hizmeti sağlıyoruz. 10 yılı aşkın tecrübemizle yanınızdayız.
        </p>
      </div>
    </aside>
  </div>
</Layout>
