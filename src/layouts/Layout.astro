---
import { SITE_TITLE, SITE_DESCRIPTION, SITE_DESCRIPTION_EN, SITE_DESCRIPTION_AR, GTM_CONTAINER_ID, TRACKING_ENABLED } from '../consts';
import Header from '../components/common/Header.astro';
import Footer from '../components/common/Footer.astro';
import SEO from '../components/common/SEO.astro';
import MobileCTA from '../components/common/MobileCTA.astro';
import WhatsAppAssistant from '../components/common/WhatsAppAssistant.astro';
import Tracking from '../components/common/Tracking.astro';
import TrackingEvents from '../components/common/TrackingEvents.astro';
import { buildWhatsAppLink, buildWhatsAppMessage, sanitizePageTitle } from '../utils/whatsapp';
import '../styles/global.css';

interface Props {
	title?: string;
	description?: string;
	lang?: string;
  image?: string;
  article?: boolean;
  breadcrumbs?: { name: string; item: string }[];
  faq?: { question: string; answer: string }[];
  whatsappTitle?: string;
  whatsappLocation?: string;
  mobileCtaVariant?: 'default' | 'contact';
}

const {
  title = SITE_TITLE,
  description: providedDescription,
  lang = 'tr',
  image,
  article = false,
  breadcrumbs,
  faq,
  whatsappTitle,
  whatsappLocation,
  mobileCtaVariant = 'default',
} = Astro.props;

const description =
  providedDescription ??
  (lang === 'en' ? SITE_DESCRIPTION_EN : lang === 'ar' ? SITE_DESCRIPTION_AR : SITE_DESCRIPTION);

const isRtl = lang === 'ar';
const sanitizedTitle = sanitizePageTitle(whatsappTitle ?? title);
const whatsappMessage = buildWhatsAppMessage({
  lang: lang === 'ar' ? 'ar' : lang === 'en' ? 'en' : 'tr',
  pageTitle: sanitizedTitle,
  location: whatsappLocation ?? null,
});
const whatsappLink = buildWhatsAppLink(whatsappMessage);
const quoteLink =
  mobileCtaVariant === 'contact'
    ? '#contact-form'
    : lang === 'ar'
      ? '/ar/get-quote/'
      : lang === 'en'
        ? '/en/get-quote/'
        : '/teklif-al/';
---

<!doctype html>
<html lang={lang} dir={isRtl ? 'rtl' : 'ltr'} class="scroll-smooth">
	<head>
    <Tracking />
    <SEO
      title={title}
      description={description}
      lang={lang}
      image={image}
      article={article}
      breadcrumbs={breadcrumbs}
      faq={faq}
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;500;600;700&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
	</head>
	<body class:list={[
    'bg-secondary text-gray-300 font-sans antialiased flex flex-col min-h-screen selection:bg-primary selection:text-white pb-16 md:pb-0',
    isRtl && 'font-arabic',
  ]}>
    {TRACKING_ENABLED && (
      <noscript>
        <iframe
          src={`https://www.googletagmanager.com/ns.html?id=${GTM_CONTAINER_ID}`}
          height="0"
          width="0"
          style="display:none;visibility:hidden"
        ></iframe>
      </noscript>
    )}
    <Header lang={lang} />
    <main id="main-content" class="flex-grow">
		  <slot />
    </main>
    <Footer lang={lang} />
    <MobileCTA lang={lang} variant={mobileCtaVariant} whatsappLink={whatsappLink} quoteLink={quoteLink} />
    <WhatsAppAssistant lang={lang} pageTitle={sanitizedTitle} location={whatsappLocation} />
    <TrackingEvents />
	</body>
</html>
