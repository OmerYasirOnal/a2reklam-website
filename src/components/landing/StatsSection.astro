---
import { STATS_CONFIG, CLIENT_LOGOS } from '../../consts';

interface Props {
  lang?: 'tr' | 'en' | 'ar';
}

const { lang = 'tr' } = Astro.props;
const isRtl = lang === 'ar';

// Translations for each stat
const translations = {
  tr: {
    corporate: { label: 'Kurumsal', sublabel: 'B2B Odaklı Üretim' },
    endToEnd: { label: 'Uçtan Uca', sublabel: 'Keşiften Montaja' },
    istanbul: { label: 'İstanbul', sublabel: 'Şehir Geneli Hizmet' },
    quality: { label: 'Kalite', sublabel: 'Malzeme ve İşçilik' },
    trustedBy: 'Güvenilir Markalar',
  },
  en: {
    corporate: { label: 'Corporate', sublabel: 'B2B Signage Focus' },
    endToEnd: { label: 'End-to-End', sublabel: 'Discovery to Install' },
    istanbul: { label: 'Istanbul', sublabel: 'Citywide Coverage' },
    quality: { label: 'Quality', sublabel: 'Materials & Craft' },
    trustedBy: 'Trusted By',
  },
  ar: {
    corporate: { label: 'حلول مؤسسية', sublabel: 'مشاريع B2B احترافية' },
    endToEnd: { label: 'تنفيذ متكامل', sublabel: 'من المعاينة إلى التركيب' },
    istanbul: { label: 'إسطنبول', sublabel: 'تغطية شاملة للمدينة' },
    quality: { label: 'جودة التصنيع', sublabel: 'مواد وتقنيات موثوقة' },
    trustedBy: 'عملاؤنا',
  },
};

const t = translations[lang];

// Filter stats based on STATS_CONFIG - only show if value is truthy
type StatKey = 'corporate' | 'endToEnd' | 'istanbul' | 'quality';
const statKeys: StatKey[] = ['corporate', 'endToEnd', 'istanbul', 'quality'];

const enabledStats = statKeys
  .filter((key) => STATS_CONFIG?.[key])
  .map((key) => ({ key, ...t[key] }));

// Don't render section if no stats enabled
const shouldRender = enabledStats.length > 0;

// Grid columns based on number of stats
const getGridClass = (count: number) => {
  if (count === 4) return 'grid-cols-2 md:grid-cols-4';
  if (count === 3) return 'grid-cols-1 md:grid-cols-3';
  if (count === 2) return 'grid-cols-2';
  return 'grid-cols-1 max-w-md mx-auto';
};
---

{shouldRender && (
  <section class="py-20 bg-secondary border-t border-white/5 relative">
    <div class="container mx-auto px-4 text-center relative z-10">
      <div class:list={['grid gap-8', getGridClass(enabledStats.length)]}>
        {enabledStats.map((stat) => (
          <div class="p-6 rounded-2xl bg-white/5 backdrop-blur-sm border border-white/5 hover:border-primary/50 transition-all group">
            <span class="block text-4xl font-heading font-black text-primary mb-2 group-hover:scale-110 transition-transform duration-300">
              {stat.label}
            </span>
            <span class="text-gray-400 text-sm font-medium uppercase tracking-wider group-hover:text-white transition-colors">
              {stat.sublabel}
            </span>
          </div>
        ))}
      </div>

      {CLIENT_LOGOS && CLIENT_LOGOS.length > 0 && (
        <div class="mt-12 pt-8 border-t border-white/5">
          <p class="text-gray-500 text-xs uppercase tracking-widest mb-6">
            {t.trustedBy}
          </p>
          <div class:list={['flex flex-wrap justify-center gap-8 items-center opacity-60', isRtl && 'flex-row-reverse']}>
            {CLIENT_LOGOS.map((client) => (
              client.url ? (
                <img
                  src={client.url}
                  alt={client.name}
                  class="h-8 grayscale hover:grayscale-0 transition-all"
                  loading="lazy"
                />
              ) : (
                <span class="text-gray-400 font-heading font-bold text-sm uppercase tracking-wider px-4 py-2 border border-white/10 rounded-lg">
                  {client.name}
                </span>
              )
            ))}
          </div>
        </div>
      )}
    </div>
  </section>
)}
