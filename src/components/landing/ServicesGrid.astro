---
import { loadImagesManifest } from '../../utils/imagesManifest';
import { buildImageAlt } from '../../utils/imageSeo';

interface Props {
  lang?: string;
}
const { lang = 'tr' } = Astro.props;

// Read manifest to get categories and representative images
let categories = [];

try {
  const manifest = loadImagesManifest();
  
  // Group by category
  const groups: Record<string, any> = {};
  manifest.forEach((item: any) => {
    if (!groups[item.category]) {
      groups[item.category] = item; // Take first one as representative
    }
  });

  categories = Object.values(groups);
} catch (e) {
  console.error('Could not read image manifest:', e);
}

const title = lang === 'en' ? 'Our Services' : 'Hizmetlerimiz';
const subtitle = lang === 'en' ? 'Quality production for every need.' : 'Her ihtiyaca uygun kaliteli üretim.';
const altLang = lang === 'en' ? 'en' : 'tr';
---

<section class="py-24 bg-secondary text-white relative overflow-hidden">
  <!-- Subtle background glow -->
  <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>

  <div class="container mx-auto px-4 relative z-10">
    <div class="text-center mb-16">
      <h2 class="font-heading font-black text-4xl md:text-5xl mb-4 text-white uppercase tracking-tight">
        {lang === 'en' ? <span class="text-primary">Our</span> : <span class="text-primary">Hizmet</span>} {title.replace('Hizmetlerimiz', '').replace('Our Services', 'Services')}
      </h2>
      <p class="text-gray-400 max-w-2xl mx-auto text-lg border-l-2 border-primary pl-4 inline-block">{subtitle}</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {categories.map((cat: any) => ( // Using 'any' for now to match script logic, can tighten later
        <a href={lang === 'en' ? `/en/services/${cat.category}/` : `/hizmetler/${cat.category}/`} class="group relative block bg-accent-light rounded-xl overflow-hidden shadow-2xl hover:shadow-primary/20 transition-all duration-500 transform hover:-translate-y-2 border border-white/5 hover:border-primary/50">
          <div class="relative h-72 overflow-hidden">
            <img 
              src={cat.paths['960']} 
              alt={buildImageAlt({ category: cat.category, lang: altLang })}
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 filter brightness-90 group-hover:brightness-100"
              loading="lazy"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-secondary via-secondary/50 to-transparent opacity-90 group-hover:opacity-70 transition-opacity duration-300"></div>
            
            <div class="absolute bottom-0 left-0 w-full p-6 translate-y-2 group-hover:translate-y-0 transition-transform duration-300">
              <h3 class="font-heading font-bold text-2xl mb-1 text-white border-b-2 border-transparent group-hover:border-primary inline-block pb-1 transition-all">
                {lang === 'en' ? cat.category_en : cat.category_tr}
              </h3>
              <p class="text-sm text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-100 mt-2">
                {lang === 'en' ? 'View Details →' : 'İncele →'}
              </p>
            </div>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>
