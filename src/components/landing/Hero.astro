---
import { loadImagesManifest } from '../../utils/imagesManifest';
import { buildImageAlt } from '../../utils/imageSeo';

interface Props {
  lang?: string;
}
const { lang = 'tr' } = Astro.props;

// Select exactly 5 deterministic hero images (priority: cephe-tabela, totem)
const manifest = loadImagesManifest();
const heroCategories = ['cephe-tabela', 'totem', 'isikli-isiksiz-tabelalar'];
const heroImages: any[] = [];

// First, collect from priority categories
for (const cat of heroCategories) {
  const catImages = manifest.filter((m: any) => m.category === cat);
  heroImages.push(...catImages);
  if (heroImages.length >= 5) break;
}

// If not enough, add from remaining categories
if (heroImages.length < 5) {
  const remaining = manifest.filter((m: any) => !heroCategories.includes(m.category));
  heroImages.push(...remaining);
}

// Take exactly 5 images
const selectedHeroImages = heroImages.slice(0, 5).map((img: any) => ({
  src: img.paths?.['1600'] || img.paths?.['960'] || '',
  alt: buildImageAlt({ category: img.category, lang: lang === 'ar' ? 'ar' : lang === 'en' ? 'en' : 'tr' }),
  category: img.category,
}));

const content = {
  tr: {
    badge: '2005\'ten beri',
    title: 'Premium Tabela ve Reklam Çözümleri',
    subtitle: 'İstanbul\'un önde gelen tabela ve reklam üreticisi. Tasarımdan montaja tam hizmet.',
    cta: 'Teklif Al',
    ctaLink: '/teklif-al/',
    contact: 'Bize Ulaşın',
    contactLink: '/iletisim/',
  },
  en: {
    badge: 'Since 2005',
    title: 'Premium Signage & Advertising Solutions',
    subtitle: 'Leading signage manufacturer in Istanbul. Full service from design to installation.',
    cta: 'Get a Quote',
    ctaLink: '/en/get-quote/',
    contact: 'Contact Us',
    contactLink: '/en/contact/',
  },
  ar: {
    badge: 'منذ 2005',
    title: 'حلول لافتات وإعلانات متميزة',
    subtitle: 'مصنّع لافتات في إسطنبول يقدم الخدمة من التصميم حتى التركيب.',
    cta: 'احصل على عرض سعر',
    ctaLink: '/ar/get-quote/',
    contact: 'تواصل معنا',
    contactLink: '/ar/contact/',
  },
};

const t = lang === 'ar' ? content.ar : lang === 'en' ? content.en : content.tr;
const isRtl = lang === 'ar';
---

<section class="hero-slider-section relative min-h-[75vh] flex items-center justify-center overflow-hidden">
  <!-- Background Slider Container -->
  <div class="hero-bg-slider absolute inset-0 z-0">
    {selectedHeroImages.map((img, idx) => (
      <div
        class:list={[
          'hero-slide absolute inset-0 transition-opacity duration-1000',
          idx === 0 ? 'opacity-100' : 'opacity-0'
        ]}
        data-index={idx}
      >
        <img
          src={img.src}
          alt={img.alt}
          class="w-full h-full object-cover hero-slide-img"
          loading={idx === 0 ? 'eager' : 'lazy'}
          fetchpriority={idx === 0 ? 'high' : 'auto'}
          decoding="async"
          width="1600"
          height="900"
        />
        <!-- Theme-agnostic overlay: always dark for contrast -->
        <div class="absolute inset-0 hero-overlay z-10"></div>
      </div>
    ))}
  </div>

  <!-- Slider Navigation Arrows -->
  <button
    type="button"
    class="hero-nav-btn hero-nav-prev absolute left-4 md:left-8 top-1/2 -translate-y-1/2 z-30 p-3 md:p-4 rounded-full bg-black/40 hover:bg-black/60 border border-white/20 hover:border-primary transition-all focus:outline-none focus:ring-2 focus:ring-primary text-white hover:text-primary"
    aria-label="Previous slide"
  >
    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={isRtl ? "M9 5l7 7-7 7" : "M15 19l-7-7 7-7"} />
    </svg>
  </button>

  <button
    type="button"
    class="hero-nav-btn hero-nav-next absolute right-4 md:right-8 top-1/2 -translate-y-1/2 z-30 p-3 md:p-4 rounded-full bg-black/40 hover:bg-black/60 border border-white/20 hover:border-primary transition-all focus:outline-none focus:ring-2 focus:ring-primary text-white hover:text-primary"
    aria-label="Next slide"
  >
    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={isRtl ? "M15 19l-7-7 7-7" : "M9 5l7 7-7 7"} />
    </svg>
  </button>

  <!-- Content with theme-agnostic styling (always white text on dark overlay) -->
  <div class:list={['hero-content relative z-30 container mx-auto px-4 text-center', isRtl && 'text-right']}>
    <div class="hero-badge inline-block mb-4 px-4 py-1 border border-primary/30 rounded-full bg-black/40 backdrop-blur-sm text-sm font-semibold tracking-wider uppercase animate-fade-in-up">
      {t.badge}
    </div>

    <!-- Text container with enhanced shadows for readability -->
    <div class="max-w-4xl mx-auto">
      <h1 class="hero-title font-heading font-black text-5xl md:text-7xl mb-6 leading-tight text-balance">
        {lang === 'en'
          ? <>Premium <span class="hero-accent">Signage</span> & Advertising Solutions</>
          : lang === 'ar'
            ? <><span class="hero-accent">حلول</span> لافتات وإعلانات متميزة</>
            : <>Premium <span class="hero-accent">Tabela</span> ve Reklam Çözümleri</>
        }
      </h1>

      <p class="hero-subtitle text-xl mb-10 max-w-2xl mx-auto leading-relaxed">
        {t.subtitle}
      </p>
    </div>

    <div class="flex flex-col md:flex-row gap-4 justify-center items-center hero-cta-group">
      <a
        href={t.ctaLink}
        data-track="lead-click"
        data-lead-type="quote"
        data-lang={lang}
        class="hero-cta-primary px-8 py-4 text-lg font-bold uppercase tracking-wide"
      >
        {t.cta}
      </a>
      <a
        href={t.contactLink}
        class="hero-cta-secondary px-8 py-4 text-lg font-bold uppercase tracking-wide"
      >
        {t.contact}
      </a>
    </div>
  </div>
</section>

<script define:vars={{ totalSlides: selectedHeroImages.length, isRtl }}>
  (function() {
    const section = document.querySelector('.hero-slider-section');
    if (!section) return;

    const slides = section.querySelectorAll('.hero-slide');
    const prevBtn = section.querySelector('.hero-nav-prev');
    const nextBtn = section.querySelector('.hero-nav-next');

    if (slides.length <= 1) {
      // Hide navigation if only one slide
      if (prevBtn) prevBtn.style.display = 'none';
      if (nextBtn) nextBtn.style.display = 'none';
      return;
    }

    let currentIndex = 0;
    let autoplayInterval = null;
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function showSlide(index) {
      slides.forEach((slide, i) => {
        if (i === index) {
          slide.classList.remove('opacity-0');
          slide.classList.add('opacity-100');
        } else {
          slide.classList.remove('opacity-100');
          slide.classList.add('opacity-0');
        }
      });
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % totalSlides;
      showSlide(currentIndex);
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
      showSlide(currentIndex);
    }

    function startAutoplay() {
      if (prefersReducedMotion) return;
      stopAutoplay();
      autoplayInterval = setInterval(nextSlide, 5000);
    }

    function stopAutoplay() {
      if (autoplayInterval) {
        clearInterval(autoplayInterval);
        autoplayInterval = null;
      }
    }

    // Navigation buttons
    prevBtn?.addEventListener('click', () => {
      prevSlide();
      stopAutoplay();
      startAutoplay();
    });

    nextBtn?.addEventListener('click', () => {
      nextSlide();
      stopAutoplay();
      startAutoplay();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!section.matches(':hover')) return;

      if (e.key === 'ArrowLeft') {
        e.preventDefault();
        if (isRtl) {
          nextSlide();
        } else {
          prevSlide();
        }
        stopAutoplay();
        startAutoplay();
      } else if (e.key === 'ArrowRight') {
        e.preventDefault();
        if (isRtl) {
          prevSlide();
        } else {
          nextSlide();
        }
        stopAutoplay();
        startAutoplay();
      }
    });

    // Pause on hover
    section.addEventListener('mouseenter', stopAutoplay);
    section.addEventListener('mouseleave', startAutoplay);

    // Start autoplay if motion is allowed
    if (!prefersReducedMotion) {
      startAutoplay();
    }
  })();
</script>

<style>
  /* ============================================
     HERO - Theme-Agnostic Styling
     Text/buttons stay consistent across dark/light
     ============================================ */

  .hero-slide-img {
    opacity: 0.85;
  }

  /* Theme-agnostic dark gradient overlay for consistent text readability */
  .hero-overlay {
    background: linear-gradient(
      to bottom,
      rgba(11, 15, 20, 0.35) 0%,
      rgba(11, 15, 20, 0.55) 40%,
      rgba(11, 15, 20, 0.75) 100%
    );
  }

  /* Hero Title - Always white with strong shadow */
  .hero-title {
    color: #FFFFFF !important;
    text-shadow:
      0 2px 4px rgba(0, 0, 0, 0.8),
      0 4px 20px rgba(0, 0, 0, 0.6);
  }

  /* Hero Accent (gold text) - Theme agnostic */
  .hero-accent {
    color: #C9A227 !important;
    text-shadow:
      0 2px 10px rgba(201, 162, 39, 0.5),
      0 0 30px rgba(201, 162, 39, 0.3);
  }

  /* Hero Subtitle - Always light gray */
  .hero-subtitle {
    color: #E5E7EB !important;
    text-shadow:
      0 1px 3px rgba(0, 0, 0, 0.7),
      0 2px 8px rgba(0, 0, 0, 0.5);
  }

  /* Hero Badge */
  .hero-badge {
    color: #C9A227 !important;
  }

  /* Hero Primary CTA - Gold button */
  .hero-cta-primary {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: #C9A227;
    color: #0B0F14 !important;
    border-radius: 0.5rem;
    box-shadow:
      0 4px 12px rgba(201, 162, 39, 0.4),
      0 2px 4px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
  }

  .hero-cta-primary:hover {
    background-color: #E0B945;
    transform: translateY(-2px);
    box-shadow:
      0 6px 16px rgba(201, 162, 39, 0.5),
      0 3px 6px rgba(0, 0, 0, 0.3);
  }

  .hero-cta-primary:focus {
    outline: 2px solid #C9A227;
    outline-offset: 2px;
  }

  /* Hero Secondary CTA - White border ghost button */
  .hero-cta-secondary {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0.3);
    color: #FFFFFF !important;
    border: 2px solid rgba(255, 255, 255, 0.4);
    border-radius: 0.5rem;
    backdrop-filter: blur(4px);
    transition: all 0.2s ease;
  }

  .hero-cta-secondary:hover {
    background-color: rgba(255, 255, 255, 0.15);
    border-color: #FFFFFF;
  }

  .hero-cta-secondary:focus {
    outline: 2px solid #FFFFFF;
    outline-offset: 2px;
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .hero-slide {
      transition: none !important;
    }

    .hero-cta-primary,
    .hero-cta-secondary {
      transition: none !important;
    }
  }
</style>
