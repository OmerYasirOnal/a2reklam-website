---
import { REVIEWS } from '../../data/reviews';
import { GOOGLE_REVIEWS_URL, GOOGLE_REVIEW_WRITE_URL, GOOGLE_RATING, GOOGLE_REVIEW_COUNT } from '../../consts';

interface Props {
  lang?: 'tr' | 'en' | 'ar';
}

const { lang = 'tr' } = Astro.props;
const isRtl = lang === 'ar';
const currentLang = lang as 'tr' | 'en' | 'ar';

// Get reviews for this language (show top 6, highlight first)
const displayedReviews = REVIEWS.slice(0, 6);

// Translations
const translations = {
  tr: {
    heading: 'Memnun Müşterilerimiz',
    subtitle: 'Google Haritalar yorumlarımızı inceleyin.',
    viewAll: 'Google\'da Tüm Yorumları Gör',
    writeReview: 'Google\'da Yorum Yaz',
    ratingLabel: '/5',
    reviewCountLabel: 'yorum',
    onGoogle: 'Google\'da',
  },
  en: {
    heading: 'Customer Reviews',
    subtitle: 'See our Google Maps reviews.',
    viewAll: 'View All on Google',
    writeReview: 'Write a Review on Google',
    ratingLabel: '/5',
    reviewCountLabel: 'reviews',
    onGoogle: 'on Google',
  },
  ar: {
    heading: 'آراء عملائنا',
    subtitle: 'اطّلع على تقييماتنا على خرائط Google.',
    viewAll: 'عرض جميع المراجعات على Google',
    writeReview: 'اكتب مراجعة على Google',
    ratingLabel: '/5',
    reviewCountLabel: 'تقييم',
    onGoogle: 'على Google',
  },
};

const t = translations[currentLang];
---

<section class="py-20 bg-secondary border-t border-white/5 relative overflow-hidden">
  <!-- Subtle background glow -->
  <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>

  <div class="container mx-auto px-4 relative z-10">
    <!-- Section Header -->
    <div class:list={['text-center mb-12', isRtl && 'text-right']}>
      <h2 class="font-heading font-black text-4xl md:text-5xl mb-4 text-white uppercase tracking-tight">
        {t.heading}
      </h2>
      <p class="text-gray-400 max-w-2xl mx-auto text-lg">
        {t.subtitle}
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
      <!-- Trust Block (Left side on desktop, right on RTL) -->
      <div class:list={['lg:col-span-1', isRtl ? 'lg:order-2' : 'order-2 lg:order-1']}>
        <div class="glass-card-padded text-center sticky top-24">
          {GOOGLE_RATING && GOOGLE_REVIEW_COUNT ? (
            <>
              <div class="flex items-center justify-center gap-1 mb-3">
                {Array.from({ length: 5 }).map((_, i) => (
                  <svg
                    class:list={[
                      'w-6 h-6',
                      i < Math.floor(GOOGLE_RATING) ? 'text-primary fill-primary' : 'text-gray-600',
                    ]}
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.562.562 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                  </svg>
                ))}
              </div>
              <div class="text-3xl font-black text-white mb-1">
                {GOOGLE_RATING}{t.ratingLabel}
              </div>
              <div class="text-sm text-gray-400 mb-6">
                {GOOGLE_REVIEW_COUNT} {t.reviewCountLabel}
              </div>
            </>
          ) : (
            <div class="mb-6">
              <div class="w-16 h-16 mx-auto mb-4 bg-primary/20 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                  <path d="M12 6c-3.314 0-6 2.686-6 6s2.686 6 6 6 6-2.686 6-6-2.686-6-6-6zm0 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>
                </svg>
              </div>
              <p class="text-sm text-gray-400 mb-4">
                {currentLang === 'ar' ? 'اطّلع على تقييماتنا' : currentLang === 'en' ? 'See our reviews' : 'Yorumlarımızı görüntüleyin'}
              </p>
            </div>
          )}
          
          <a
            href={GOOGLE_REVIEWS_URL}
            target="_blank"
            rel="noopener noreferrer"
            data-track="lead-click"
            data-lead-type="cta"
            data-lang={lang}
            class="btn btn-primary w-full mb-3 text-sm font-bold uppercase tracking-wide"
          >
            {t.viewAll}
          </a>
          
          <a
            href={GOOGLE_REVIEW_WRITE_URL}
            target="_blank"
            rel="noopener noreferrer"
            data-track="lead-click"
            data-lead-type="cta"
            data-lang={lang}
            class="btn btn-secondary w-full text-sm font-bold uppercase tracking-wide"
          >
            {t.writeReview}
          </a>
        </div>
      </div>

      <!-- Review Cards (Right side on desktop, left on RTL) -->
      <div class:list={['lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-6', isRtl ? 'lg:order-1' : 'order-1 lg:order-2']}>
        {displayedReviews.map((review) => {
          const reviewText = review.text[currentLang] || review.text.tr;
          return (
            <div class="glass-card group p-6">
              {review.rating && (
                <div class="flex items-center gap-1 mb-4" aria-label={`${review.rating} out of 5 stars`}>
                  {Array.from({ length: 5 }).map((_, i) => (
                    <svg
                      class="w-4 h-4"
                      class:list={[
                        i < review.rating ? 'text-primary fill-primary' : 'text-gray-600',
                      ]}
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.562.562 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                    </svg>
                  ))}
                </div>
              )}
              
              <p class="text-gray-300 text-sm leading-relaxed mb-4 line-clamp-4 group-hover:line-clamp-none transition-all duration-300">
                "{reviewText}"
              </p>
              
              <div class:list={['flex items-center justify-between pt-4 border-t border-white/5', isRtl && 'flex-row-reverse']}>
                <div>
                  <div class="text-white font-semibold text-sm">{review.author}</div>
                  {review.date && (
                    <div class="text-gray-500 text-xs mt-1">
                      {review.date}
                    </div>
                  )}
                </div>
                {currentLang === 'ar' ? (
                  <svg class="w-5 h-5 text-primary/50 rtl-mirror" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                ) : (
                  <svg class="w-5 h-5 text-primary/50" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </div>
</section>
