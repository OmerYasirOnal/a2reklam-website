---
import { TRACKING_ENABLED } from '../../consts';
---

{TRACKING_ENABLED && (
  <script>
    // Inline tracking functions to avoid module import 404s
    (function() {
      function getDataLayer() {
        if (typeof window === 'undefined') return null;
        const win = window;
        if (!Array.isArray(win.dataLayer)) {
          win.dataLayer = [];
        }
        return win.dataLayer;
      }

      function trackCTAClick(event) {
        const dataLayer = getDataLayer();
        if (!dataLayer) return;
        dataLayer.push({
          event: 'cta_click',
          cta_type: event.type,
          lang: event.lang,
          page: event.page,
        });
      }

      function trackLeadSubmit(event) {
        const dataLayer = getDataLayer();
        if (!dataLayer) return;
        dataLayer.push({
          event: 'lead_submit',
          lead_type: event.type,
          lang: event.lang,
          page: event.page,
        });
      }

      const getLang = (el) =>
        el?.getAttribute('data-lang') || document.documentElement.lang || 'tr';
      const getPage = () => window.location.pathname || '/';

      const bindCTAClicks = () => {
        // Track WhatsApp clicks
        document.querySelectorAll('[data-track="whatsapp"]').forEach((el) => {
          el.addEventListener('click', () => {
            trackCTAClick({ type: 'whatsapp', lang: getLang(el), page: getPage() });
          });
        });

        // Track phone clicks
        document.querySelectorAll('[data-track="call"]').forEach((el) => {
          el.addEventListener('click', () => {
            trackCTAClick({ type: 'call', lang: getLang(el), page: getPage() });
          });
        });

        // Track quote clicks
        document.querySelectorAll('[data-track="quote"]').forEach((el) => {
          el.addEventListener('click', () => {
            trackCTAClick({ type: 'quote', lang: getLang(el), page: getPage() });
          });
        });
      };

      const bindLeadSubmits = () => {
        document.querySelectorAll('form[data-track="lead-submit"]').forEach((form) => {
          form.addEventListener('submit', () => {
            const type = form.getAttribute('data-lead-type') || 'quote';
            trackLeadSubmit({ type, lang: getLang(form), page: getPage() });
          });
        });
      };

      const init = () => {
        bindCTAClicks();
        bindLeadSubmits();
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
)}
